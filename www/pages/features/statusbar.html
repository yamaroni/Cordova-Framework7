<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a class="link back no-ripple no-active-state">
                        <i class="icon icon-back"></i>
                    </a>
                </div>
                <div class="title">Statusbar</div>
            </div>
        </div>

        <div class="page-content">
            <div class="block-title">Color Picker</div>
            <div class="margin-horizontal-half" id="statusbar-color-picker"></div>
            <div class="list links-list no-chevron no-hairlines no-hairlines-between">
                <ul class="margin-horizontal">
                    <li class="bg-color-primary text-color-white margin-bottom-half" style="border-radius: .5rem;">
                        <a @click="${()=> setStatusbarByPicker()}" class="no-ripple no-active-state">
                            <svg class="text-color-white" width="24" heigth="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"></path>
                            </svg>
                            <div style="font-weight: bold;">Statusbar Color by Picker</div>
                        </a>
                    </li>
                    <li class="bg-color-primary text-color-white margin-bottom-half" style="border-radius: .5rem;">
                        <a @click="${()=> setStatusbarSemiTransparent()}" class="no-ripple no-active-state">
                            <svg class="text-color-white" width="24" heigth="24" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M11 9h2v2h-2zm-2 2h2v2H9zm4 0h2v2h-2zm2-2h2v2h-2zM7 9h2v2H7zm12-6H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 18H7v-2h2v2zm4 0h-2v-2h2v2zm4 0h-2v-2h2v2zm2-7h-2v2h2v2h-2v-2h-2v2h-2v-2h-2v2H9v-2H7v2H5v-2h2v-2H5V5h14v6z"></path>
                            </svg>
                            <div style="font-weight: bold;">Semi-Transparent Statusbar</div>
                        </a>
                    </li>
                    ${isStatusbarVisible ? $h`
                        <li class="bg-color-primary text-color-white margin-bottom-half" style="border-radius: .5rem;">
                            <a @click="${()=> setStatusbarHide()}" class="no-ripple no-active-state">
                                <svg class="text-color-white" width="24" heigth="24" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"></path>
                                </svg>
                                <div style="font-weight: bold;">Hide Statusbar</div>
                            </a>
                        </li>
                    ` : $h`
                        <li class="bg-color-primary text-color-white margin-bottom-half" style="border-radius: .5rem;">
                            <a @click="${()=> setStatusbarShow()}" class="no-ripple no-active-state">
                                <svg class="text-color-white" width="24" heigth="24" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path>
                                </svg>
                                <div style="font-weight: bold;">Show Statusbar</div>
                            </a>
                        </li>
                    `}
                </ul>
            </div>
        </div>
    </div>
</template>
<script>
    "user strict"
    export default (props, { $onBeforeMount, $onMounted, $onBeforeUnmount, $f7, $update }) => {

        let colorPicker,
            isStatusbarVisible = true
        
        $onBeforeMount(() => {
            console.log('status-bar:before-mount')
            document.addEventListener('backbutton', $onBackButton, false)
        })

        $onMounted(() => {
            console.log('status-bar:mounted')
            initColorPicker()

            if (cordova.platformId == 'android') {
                StatusBar.isVisible ? isStatusbarVisible = true : isStatusbarVisible = false
                $update()
            }
        })

        $onBeforeUnmount(() => {
            console.log('status-bar:before-unmount')
            document.removeEventListener('backbutton', $onBackButton, false)
        })

        ///USECASE
        const initColorPicker = () => {
            colorPicker = $f7.colorPicker.create({
                containerEl: '#statusbar-color-picker',
                modules: ['sb-spectrum', 'hsb-sliders', 'alpha-slider'],
                value: {
                    hex: '#0859c6',
                },
            })
        }
        const setStatusbarByPicker = () => {
            console.log(`statusbar: ${colorPicker.value.hex}`)

            if (cordova.platformId == 'android') {
                StatusBar.overlaysWebView(false)
                StatusBar.backgroundColorByHexString(colorPicker.value.hex)
            }
        }
        const setStatusbarSemiTransparent = () => {
            console.log('statusbar: semi-transparent')

            if (cordova.platformId == 'android') {
                StatusBar.overlaysWebView(true)
                StatusBar.backgroundColorByHexString("#33000000")
            }
        }
        const setStatusbarHide = () => {
            console.log('statusbar: hide')
            
            if (cordova.platformId == 'android') {
                StatusBar.hide()
            }
            isStatusbarVisible = false
            $update()
        }
        const setStatusbarShow = () => {
            console.log('statusbar: show')

            if (cordova.platformId == 'android') {
                StatusBar.show()
            }
            isStatusbarVisible = true
            $update()
        }

        ///HELPER
        const $onBackButton = (e) => {
            console.log('statusbar:back')
            e.preventDefault()
            back()
        }
        const back = () => {
            $f7.view.main.router.back()
        }

        return $render
    }
</script>